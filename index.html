<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Utilities Performance Summary Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
:root{--bg:#050814;--card:#0D1525;--text:#F0F4F8;--muted:#7C8BA1;--accent:#00E5FF;--accent2:#9D4EDD;--accent3:#06FFA5;--danger:#FF3B6D;--border:#1A2332;--glow-cyan:rgba(0,229,255,0.4);--glow-purple:rgba(157,78,221,0.4);--glow-green:rgba(6,255,165,0.4);}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg);background-image:radial-gradient(circle at 15% 20%,var(--glow-purple) 0%,transparent 40%),radial-gradient(circle at 85% 80%,var(--glow-cyan) 0%,transparent 40%),radial-gradient(circle at 50% 50%,var(--glow-green) 0%,transparent 60%);color:var(--text);min-height:100vh;padding:20px;}
.loading-container{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;gap:20px;}
.loading-spinner{width:60px;height:60px;border:4px solid rgba(0,229,255,0.1);border-top:4px solid var(--accent);border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.loading-text{color:var(--accent);font-size:1.2rem;font-weight:600;}
.error-container{background:linear-gradient(135deg,rgba(255,59,109,0.1) 0%,rgba(255,59,109,0.05) 100%);border:2px solid var(--danger);border-radius:16px;padding:30px;max-width:600px;margin:40px auto;text-align:center;}
.error-title{color:var(--danger);font-size:1.5rem;font-weight:700;margin-bottom:15px;}
.error-message{color:var(--text);font-size:1rem;line-height:1.6;margin-bottom:20px;}
.error-details{background:rgba(0,0,0,0.3);border-radius:8px;padding:15px;font-family:monospace;font-size:0.9rem;color:var(--muted);margin-top:15px;text-align:left;overflow-x:auto;}
.header{text-align:center;margin-bottom:40px;}
h1{font-size:2.8rem;font-weight:700;background:linear-gradient(135deg,var(--accent) 0%,var(--accent2) 50%,var(--accent3) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px;letter-spacing:-1px;}
.subtitle{color:var(--muted);font-size:1rem;font-weight:500;}
.controls-container{max-width:1400px;margin:0 auto 30px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:25px 30px;box-shadow:0 4px 20px rgba(0,0,0,0.3);}
.controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;align-items:end;}
.control-group{display:flex;flex-direction:column;gap:10px;}
.control-label{font-size:0.8rem;text-transform:uppercase;letter-spacing:1px;color:var(--accent);font-weight:700;display:flex;align-items:center;gap:6px;}
.control-label::before{content:'';width:4px;height:14px;background:linear-gradient(180deg,var(--accent),var(--accent2));border-radius:2px;}
select{background:rgba(21,30,61,0.9);color:var(--text);border:2px solid var(--border);padding:12px 16px;border-radius:12px;font-size:0.95rem;font-weight:500;cursor:pointer;transition:all 0.3s ease;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2300D9FF' d='M6 9L1 4h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:40px;}
select[multiple]{background-image:none;padding-right:16px;}
select:hover{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,217,255,0.1);}
select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,217,255,0.2);}
select option{background:var(--card);color:var(--text);padding:10px;}
select option:checked{background:linear-gradient(90deg,var(--accent2),var(--accent));color:white;}
.dashboard{max-width:1600px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:25px;}
.card{background:linear-gradient(135deg,rgba(13,21,37,0.9) 0%,rgba(17,27,46,0.9) 100%);border:1px solid var(--border);border-radius:20px;padding:25px;box-shadow:0 8px 32px rgba(0,0,0,0.6),inset 0 1px 0 rgba(255,255,255,0.05);transition:all 0.4s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden;}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--accent),var(--accent2),var(--accent3));opacity:0;transition:opacity 0.3s ease;}
.card:hover{transform:translateY(-8px) scale(1.02);box-shadow:0 20px 60px rgba(0,229,255,0.3),0 0 40px rgba(0,229,255,0.2);border-color:var(--accent);}
.card:hover::before{opacity:1;}
.card h3{font-size:1.1rem;color:var(--text);margin:0 0 20px 0;font-weight:600;display:flex;align-items:center;gap:10px;}
.card h3::before{content:'';width:6px;height:20px;background:linear-gradient(180deg,var(--accent),var(--accent2));border-radius:3px;}
canvas{filter:drop-shadow(0 4px 12px rgba(0,0,0,0.2));}
@media (max-width:1400px){.dashboard{grid-template-columns:repeat(2,1fr);}}
@media (max-width:900px){.dashboard{grid-template-columns:1fr;}.controls{grid-template-columns:1fr;}h1{font-size:2rem;}}
</style>
</head>
<body>
<div class="header"><h1>⚡ Utilities Performance Dashboard</h1><p class="subtitle">Real-time Performance Monitoring & Analytics</p></div>
<div id="loadingIndicator" class="loading-container"><div class="loading-spinner"></div><div class="loading-text">Loading dashboard data...</div></div>
<div id="errorContainer" style="display:none;"></div>
<div id="controlsContainer" class="controls-container" style="display:none;"><div class="controls"><div class="control-group"><label class="control-label">Project Filter</label><select id="projectSelect"><option value="All">All Projects</option></select></div><div class="control-group"><label class="control-label">Year Selection</label><select id="yearSelect" multiple size="4"></select></div></div></div>
<div id="dashboard" class="dashboard"></div>
<script>
Chart.register(ChartDataLabels);
const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const colorPalette=[{bg:"rgba(0,229,255,0.85)",border:"#00E5FF"},{bg:"rgba(157,78,221,0.85)",border:"#9D4EDD"},{bg:"rgba(6,255,165,0.85)",border:"#06FFA5"},{bg:"rgba(255,184,0,0.85)",border:"#FFB800"},{bg:"rgba(255,59,109,0.85)",border:"#FF3B6D"},{bg:"rgba(99,102,241,0.85)",border:"#6366F1"}];
let rawData=[],charts=[],selectedYears=[];
const loadingIndicator=document.getElementById('loadingIndicator'),errorContainer=document.getElementById('errorContainer'),controlsContainer=document.getElementById('controlsContainer'),projectSelect=document.getElementById('projectSelect'),yearSelect=document.getElementById('yearSelect'),dashboard=document.getElementById('dashboard');
window.onload=()=>setTimeout(()=>fetch('data.csv?'+Date.now()).then(r=>r.ok?r.text():Promise.reject(new Error(`HTTP ${r.status}`))).then(t=>{loadCSV(t);loadingIndicator.style.display='none';controlsContainer.style.display='block';}).catch(e=>{console.error(e);loadingIndicator.style.display='none';showError(e);}),500);
function showError(e){errorContainer.style.display='block';errorContainer.innerHTML=`<div class="error-container"><div class="error-title">⚠️ Failed to Load Data</div><div class="error-message">Unable to load CSV file. Ensure data.csv exists in the same directory.</div><div class="error-details">Error: ${e.message}<br><br>Expected: ${location.origin}${location.pathname.replace('index.html','')}data.csv</div></div>`;}
projectSelect.onchange=render;
yearSelect.onchange=()=>{selectedYears=[...yearSelect.selectedOptions].map(o=>+o.value);render();};
function loadCSV(t){const rows=t.trim().split("\n"),h=rows[0].split(",");rawData=rows.slice(1).map(r=>{const c=r.split(","),o={};h.forEach((x,i)=>o[x.trim()]=c[i]);return o;});projectSelect.innerHTML='<option value="All">All Projects</option>';[...new Set(rawData.map(d=>d["Project name"]))].forEach(p=>projectSelect.innerHTML+=`<option>${p}</option>`);const years=[...new Set(rawData.map(d=>+("20"+d.Date.split("-")[1])))].sort();yearSelect.innerHTML=years.map(y=>`<option selected value="${y}">${y}</option>`).join("");selectedYears=years;render();}
function render(){if(!selectedYears.length)return;charts.forEach(c=>c.destroy());charts=[];dashboard.innerHTML="";const p=projectSelect.value,d=p==="All"?rawData:rawData.filter(x=>x["Project name"]===p);expectedP50VsActual(d,p);actualMWhWithGTI(d,p);yearOverYearComparison(d,p);wcAchievedYoY(d,p);wcNOCYoY(d,p);actGAComparison(d,p);actPAComparison(d,p);}
function expectedP50VsActual(data,proj){const p50Data={},actData={},datasets=[];selectedYears.forEach(yr=>{p50Data[yr]={};actData[yr]={};});data.forEach(d=>{let[m,y]=d.Date.split("-"),year=+("20"+y);if(!selectedYears.includes(year))return;let p50=parseFloat(d["Expected P50 MWh"]),act=parseFloat(d["Actual MWh"]);if(!isNaN(p50))p50Data[year][m]=(p50Data[year][m]||0)+p50;if(!isNaN(act))actData[year][m]=(actData[year][m]||0)+act;});selectedYears.forEach((yr,i)=>{const c=colorPalette[i%6];datasets.push({label:`Expected P50 ${yr}`,data:months.map(m=>p50Data[yr][m]||null),backgroundColor:c.bg.replace('.85','.5'),borderColor:c.border,borderWidth:2,barPercentage:.8,categoryPercentage:.9},{label:`Actual ${yr}`,data:months.map(m=>actData[yr][m]||null),backgroundColor:c.bg,borderColor:c.border,borderWidth:2,barPercentage:.8,categoryPercentage:.9});});addGroupedBarChart("Expected P50 vs Actual MWh",datasets);}
function actualMWhWithGTI(data,proj){const mwhDs=[],gtiDs=[];selectedYears.forEach((yr,i)=>{const mwhVals={},gtiVals={},gtiCounts={};data.forEach(d=>{let[m,y]=d.Date.split("-");if(+("20"+y)!==yr)return;let mwh=parseFloat(d["Actual MWh"]),gti=parseFloat(d["Actual GTI"]);if(!isNaN(mwh))mwhVals[m]=(mwhVals[m]||0)+mwh;if(!isNaN(gti)){gtiVals[m]=(gtiVals[m]||0)+gti;gtiCounts[m]=(gtiCounts[m]||0)+1;}});const c=colorPalette[i%6];mwhDs.push({label:`MWh ${yr}`,data:months.map(m=>mwhVals[m]??null),backgroundColor:c.bg,borderColor:c.border,borderWidth:2,barPercentage:.85});gtiDs.push({label:`GTI ${yr}${proj==="All"?" (Avg)":""}`,data:months.map(m=>gtiCounts[m]?gtiVals[m]/gtiCounts[m]:null),borderColor:c.border,backgroundColor:c.bg.replace('.85','.2'),tension:.4,borderWidth:3,pointRadius:6,pointBackgroundColor:c.border,fill:true});});addDualAxisChart("Actual MWh & GTI Comparison",mwhDs,gtiDs);}
function wcAchievedYoY(data,proj){const datasets=[];selectedYears.forEach((yr,i)=>{const vals={},counts={};data.forEach(d=>{let[m,y]=d.Date.split("-");if(+("20"+y)!==yr)return;let v=parseFloat(d["WC Achieved"]);if(!isNaN(v)){vals[m]=(vals[m]||0)+v;counts[m]=(counts[m]||0)+1;}});const monthData=months.map(m=>counts[m]?vals[m]/counts[m]:null),c=colorPalette[i%6];datasets.push({label:`WC Achieved ${yr}${proj==="All"?" (Avg)":""}`,data:monthData,borderColor:c.border,backgroundColor:c.bg.replace('.85','.2'),tension:.4,borderWidth:3,pointRadius:6,pointBackgroundColor:c.border,fill:true,datalabels:{display:true,align:'top',offset:8,formatter:v=>v===null?'':(v-100>=0?`+${(v-100).toFixed(1)}%`:`${(v-100).toFixed(1)}%`),color:ctx=>ctx.dataset.data[ctx.dataIndex]>=100?'#00F5A0':'#FF4757',font:{weight:'bold',size:11}}});});addChart("WC Achieved (Year over Year)",datasets,false,true);}
function wcNOCYoY(data,proj){const datasets=[];selectedYears.forEach((yr,i)=>{const vals={},counts={};data.forEach(d=>{let[m,y]=d.Date.split("-");if(+("20"+y)!==yr)return;let v=parseFloat(d.WC_NOC);if(!isNaN(v)){vals[m]=(vals[m]||0)+v;counts[m]=(counts[m]||0)+1;}});const monthData=months.map(m=>counts[m]?vals[m]/counts[m]:null),c=colorPalette[i%6];datasets.push({label:`WC_NOC ${yr}${proj==="All"?" (Avg)":""}`,data:monthData,borderColor:c.border,backgroundColor:c.bg.replace('.85','.2'),tension:.4,borderWidth:3,pointRadius:6,pointBackgroundColor:c.border,fill:true,datalabels:{display:true,align:'top',offset:8,formatter:(v,ctx)=>{if(v===null||ctx.dataIndex===0)return'';const pv=ctx.dataset.data[ctx.dataIndex-1];if(pv===null)return'';const d=v-pv;return d>=0?`+${d.toFixed(1)}`:`${d.toFixed(1)}`;},color:ctx=>{if(ctx.dataIndex===0)return c.border;const v=ctx.dataset.data[ctx.dataIndex],pv=ctx.dataset.data[ctx.dataIndex-1];if(v===null||pv===null)return c.border;return(v-pv)>=0?'#06FFA5':'#FF3B6D';},font:{weight:'bold',size:10}}});});addChart("WC_NOC with Delta (Month-over-Month)",datasets,false,true);}
function yearOverYearComparison(data,proj){if(selectedYears.length<2)return;const sy=[...selectedYears].sort(),cy=sy[sy.length-1],py=sy[sy.length-2],cMWh={},pMWh={},cGTI={},pGTI={},gtiC={current:{},previous:{}};data.forEach(d=>{let[m,y]=d.Date.split("-"),year=+("20"+y),mwh=parseFloat(d["Actual MWh"]),gti=parseFloat(d["Actual GTI"]);if(year===cy){if(!isNaN(mwh))cMWh[m]=(cMWh[m]||0)+mwh;if(!isNaN(gti)){cGTI[m]=(cGTI[m]||0)+gti;gtiC.current[m]=(gtiC.current[m]||0)+1;}}else if(year===py){if(!isNaN(mwh))pMWh[m]=(pMWh[m]||0)+mwh;if(!isNaN(gti)){pGTI[m]=(pGTI[m]||0)+gti;gtiC.previous[m]=(gtiC.previous[m]||0)+1;}}});addDualAxisChart(`YoY Comparison: ${py} vs ${cy}`,[{label:`Actual MWh ${py}`,data:months.map(m=>pMWh[m]||null),backgroundColor:colorPalette[0].bg.replace('.85','.5'),borderColor:colorPalette[0].border,borderWidth:2,barPercentage:.85},{label:`Actual MWh ${cy}`,data:months.map(m=>cMWh[m]||null),backgroundColor:colorPalette[0].bg,borderColor:colorPalette[0].border,borderWidth:2,barPercentage:.85}],[{label:`GTI ${py}${proj==="All"?" (Avg)":""}`,data:months.map(m=>gtiC.previous[m]?pGTI[m]/gtiC.previous[m]:null),borderColor:colorPalette[1].border,backgroundColor:colorPalette[1].bg.replace('.85','.2'),tension:.4,borderWidth:3,pointRadius:6,pointBackgroundColor:colorPalette[1].border,fill:true},{label:`GTI ${cy}${proj==="All"?" (Avg)":""}`,data:months.map(m=>gtiC.current[m]?cGTI[m]/gtiC.current[m]:null),borderColor:colorPalette[2].border,backgroundColor:colorPalette[2].bg.replace('.85','.2'),tension:.4,borderWidth:3,pointRadius:6,pointBackgroundColor:colorPalette[2].border,fill:true}]);}
function actGAComparison(data,proj){const th=["AWS","SECI-9"].includes(proj)?99.5:99.4,datasets=[];selectedYears.forEach((yr,i)=>{const vals={},counts={};data.forEach(d=>{let[m,y]=d.Date.split("-");if(+("20"+y)!==yr)return;let v=parseFloat(d["Act. GA (%)"]);if(!isNaN(v)){vals[m]=(vals[m]||0)+v;counts[m]=(counts[m]||0)+1;}});const monthData=months.map(m=>counts[m]?vals[m]/counts[m]:null),c=colorPalette[i%6];datasets.push({label:`GA ${yr}${proj==="All"?" (Avg)":""}`,data:monthData,borderColor:c.border,backgroundColor:c.bg.replace('.85','.2'),segment:{borderColor:ctx=>ctx.p1.parsed.y<th?"#FF4757":c.border,borderWidth:ctx=>ctx.p1.parsed.y<th?4:3},tension:.4,borderWidth:3,pointRadius:6,pointBackgroundColor:monthData.map(v=>v!==null&&v<th?"#FF4757":c.border),fill:true});});addChart(`Act. GA (%) - Threshold: ${th}%${proj==="All"?" (Avg)":""}`,datasets,true);}
function actPAComparison(data,proj){const th=["AWS","SECI-9"].includes(proj)?99.5:99.4,datasets=[];selectedYears.forEach((yr,i)=>{const vals={},counts={};data.forEach(d=>{let[m,y]=d.Date.split("-");if(+("20"+y)!==yr)return;let v=parseFloat(d["Act. PA (%)"]);if(!isNaN(v)){vals[m]=(vals[m]||0)+v;counts[m]=(counts[m]||0)+1;}});const monthData=months.map(m=>counts[m]?vals[m]/counts[m]:null),c=colorPalette[i%6];datasets.push({label:`PA ${yr}${proj==="All"?" (Avg)":""}`,data:monthData,borderColor:c.border,backgroundColor:c.bg.replace('.85','.2'),segment:{borderColor:ctx=>ctx.p1.parsed.y<th?"#FF4757":c.border,borderWidth:ctx=>ctx.p1.parsed.y<th?4:3},tension:.4,borderWidth:3,pointRadius:6,pointBackgroundColor:monthData.map(v=>v!==null&&v<th?"#FF4757":c.border),fill:true});});addChart(`Act. PA (%) - Threshold: ${th}%${proj==="All"?" (Avg)":""}`,datasets,true);}
function addChart(title,datasets,limit100=false,showLabels=false){const c=document.createElement("div");c.className="card";c.innerHTML=`<h3>${title}</h3><canvas></canvas>`;dashboard.appendChild(c);charts.push(new Chart(c.querySelector("canvas"),{type:"line",data:{labels:months,datasets},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{labels:{color:"#E8EAED",font:{size:12,weight:'600'},padding:15,usePointStyle:true},position:'top'},datalabels:{display:showLabels},tooltip:{backgroundColor:'rgba(21,30,61,0.95)',titleColor:'#00D9FF',bodyColor:'#E8EAED',borderColor:'#252E4A',borderWidth:1,padding:12}},scales:{x:{ticks:{color:"#8B92AB",font:{size:11}},grid:{color:"rgba(37,46,74,0.5)"}},y:{max:limit100?100:undefined,ticks:{color:"#8B92AB",font:{size:11}},grid:{color:"rgba(37,46,74,0.5)"}}}}}));}
function addGroupedBarChart(title,datasets){const c=document.createElement("div");c.className="card";c.innerHTML=`<h3>${title}</h3><canvas></canvas>`;dashboard.appendChild(c);charts.push(new Chart(c.querySelector("canvas"),{type:"bar",data:{labels:months,datasets},options:{responsive:true,maintainAspectRatio:true,interaction:{mode:'index',intersect:false},plugins:{legend:{labels:{color:"#E8EAED",font:{size:12,weight:'600'},padding:15,usePointStyle:true},position:'top'},datalabels:{display:false},tooltip:{backgroundColor:'rgba(21,30,61,0.95)',titleColor:'#00D9FF',bodyColor:'#E8EAED',borderColor:'#252E4A',borderWidth:1,padding:12}},scales:{x:{ticks:{color:"#8B92AB"},grid:{display:false}},y:{ticks:{color:"#8B92AB"},grid:{color:"rgba(37,46,74,0.5)"},title:{display:true,text:"MWh",color:"#00D9FF",font:{size:12,weight:'700'}}}}}}));}
function addDualAxisChart(title,barDs,lineDs){const c=document.createElement("div");c.className="card";c.innerHTML=`<h3>${title}</h3><canvas></canvas>`;dashboard.appendChild(c);charts.push(new Chart(c.querySelector("canvas"),{type:"bar",data:{labels:months,datasets:[...barDs.map(ds=>({...ds,type:'bar',yAxisID:'y'})),...lineDs.map(ds=>({...ds,type:'line',yAxisID:'y1'}))]},options:{responsive:true,maintainAspectRatio:true,interaction:{mode:'index',intersect:false},plugins:{legend:{labels:{color:"#E8EAED",font:{size:12,weight:'600'},padding:15},position:'top'},datalabels:{display:false},tooltip:{backgroundColor:'rgba(21,30,61,0.95)',titleColor:'#00D9FF',bodyColor:'#E8EAED',borderColor:'#252E4A',borderWidth:1,padding:12}},scales:{x:{ticks:{color:"#8B92AB"},grid:{display:false}},y:{type:'linear',position:'left',ticks:{color:"#8B92AB"},grid:{color:"rgba(37,46,74,0.5)"},title:{display:true,text:"MWh",color:"#00D9FF",font:{size:12,weight:'700'}}},y1:{type:'linear',position:'right',ticks:{color:"#8B92AB"},grid:{display:false},title:{display:true,text:"GTI",color:"#7C3AED",font:{size:12,weight:'700'}}}}}));}
</script>
</body>
</html>
