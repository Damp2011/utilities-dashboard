<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Utilities Performance Summary Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

:root{
  --bg:#050814;
  --card:#0D1525;
  --text:#F0F4F8;
  --muted:#7C8BA1;
  --accent:#00E5FF;
  --accent2:#9D4EDD;
  --accent3:#06FFA5;
  --danger:#FF3B6D;
  --border:#1A2332;
  --glow-cyan:rgba(0,229,255,0.4);
  --glow-purple:rgba(157,78,221,0.4);
  --glow-green:rgba(6,255,165,0.4);
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Inter',sans-serif;
  background:var(--bg);
  background-image:
    radial-gradient(circle at 15% 20%,var(--glow-purple) 0%,transparent 40%),
    radial-gradient(circle at 85% 80%,var(--glow-cyan) 0%,transparent 40%),
    radial-gradient(circle at 50% 50%,var(--glow-green) 0%,transparent 60%);
  color:var(--text);
  min-height:100vh;
  padding:20px;
}

.header{text-align:center;margin-bottom:40px}
h1{
  font-size:2.8rem;
  font-weight:700;
  background:linear-gradient(135deg,var(--accent),var(--accent2),var(--accent3));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.subtitle{color:var(--muted)}

.loading-container{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:60vh;
  gap:20px;
}
.loading-spinner{
  width:60px;height:60px;
  border:4px solid rgba(0,229,255,.15);
  border-top:4px solid var(--accent);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

.controls-container{
  max-width:1400px;
  margin:0 auto 30px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:25px;
}

.controls{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:20px;
}

select{
  background:#121b33;
  color:var(--text);
  border:1px solid var(--border);
  padding:12px;
  border-radius:10px;
}

.dashboard{
  max-width:1600px;
  margin:auto;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:25px;
}

.card{
  background:linear-gradient(135deg,#0d1525,#111b2e);
  border:1px solid var(--border);
  border-radius:20px;
  padding:25px;
}

.card h3{margin-bottom:15px}

@media(max-width:1200px){
  .dashboard{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:800px){
  .dashboard{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="header">
  <h1>âš¡ Utilities Performance Dashboard</h1>
  <p class="subtitle">Real-time Performance Monitoring & Analytics</p>
</div>

<div id="loadingIndicator" class="loading-container">
  <div class="loading-spinner"></div>
  <div style="color:var(--accent)">Loading dashboard data...</div>
</div>

<div id="controlsContainer" class="controls-container" style="display:none">
  <div class="controls">
    <div>
      <label>Project</label>
      <select id="projectSelect"></select>
    </div>
    <div>
      <label>Year</label>
      <select id="yearSelect" multiple size="4"></select>
    </div>
  </div>
</div>

<div id="dashboard" class="dashboard"></div>

<script>
Chart.register(ChartDataLabels);

const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const colors=["#00E5FF","#9D4EDD","#06FFA5","#FFB800","#FF3B6D","#6366F1"];

let rawData=[],charts=[],selectedYears=[];

const loadingIndicator=document.getElementById("loadingIndicator");
const controlsContainer=document.getElementById("controlsContainer");
const projectSelect=document.getElementById("projectSelect");
const yearSelect=document.getElementById("yearSelect");
const dashboard=document.getElementById("dashboard");

window.onload=()=>{
  fetch("data.csv?"+Date.now())
    .then(r=>r.text())
    .then(loadCSV)
    .then(()=>{
      loadingIndicator.style.display="none";
      controlsContainer.style.display="block";
    })
};

function loadCSV(text){
  const rows=text.trim().split("\n");
  const headers=rows[0].split(",").map(h=>h.trim());

  rawData=rows.slice(1)
    .map(r=>{
      if(!r.trim())return null;
      const c=r.split(",");
      const o={};
      headers.forEach((h,i)=>o[h]=(c[i]||"").trim());
      return o;
    })
    .filter(d=>d && d.Date && d.Date.includes("-"));

  projectSelect.innerHTML='<option value="All">All</option>';
  [...new Set(rawData.map(d=>d["Project name"]))].forEach(p=>{
    if(p)projectSelect.innerHTML+=`<option>${p}</option>`;
  });

  const years=[...new Set(rawData.map(d=>"20"+d.Date.split("-")[1]))];
  yearSelect.innerHTML=years.map(y=>`<option selected>${y}</option>`).join("");
  selectedYears=years.map(Number);

  projectSelect.onchange=render;
  yearSelect.onchange=()=>{
    selectedYears=[...yearSelect.selectedOptions].map(o=>+o.value);
    render();
  };

  render();
}

function render(){
  charts.forEach(c=>c.destroy());
  charts=[];
  dashboard.innerHTML="";

  const p=projectSelect.value;
  const data=p==="All"?rawData:rawData.filter(d=>d["Project name"]===p);

  simpleChart("Actual MWh",data,"Actual MWh");
  simpleChart("Expected P50 MWh",data,"Expected P50 MWh");
}

function simpleChart(title,data,key){
  const yearly={};
  selectedYears.forEach(y=>yearly[y]={});

  data.forEach(d=>{
    const [m,y]=d.Date.split("-");
    const year=+("20"+y);
    if(!selectedYears.includes(year))return;
    const v=parseFloat(d[key]);
    if(!isNaN(v))yearly[year][m]=(yearly[year][m]||0)+v;
  });

  const datasets=selectedYears.map((y,i)=>({
    label:y,
    data:months.map(m=>yearly[y][m]||null),
    borderColor:colors[i%colors.length],
    backgroundColor:colors[i%colors.length],
    tension:.4
  }));

  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`<h3>${title}</h3><canvas></canvas>`;
  dashboard.appendChild(div);

  charts.push(new Chart(div.querySelector("canvas"),{
    type:"line",
    data:{labels:months,datasets},
    options:{responsive:true}
  }));
}
</script>

</body>
</html>
