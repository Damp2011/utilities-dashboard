<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Utilities Performance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  margin:0;
  font-family:Inter,Segoe UI,Arial;
  background:linear-gradient(135deg,#0b102e,#081a3a,#031b2f);
  color:#fff;
}
header{
  text-align:center;
  padding:30px 10px;
}
header h1{
  font-size:40px;
  background:linear-gradient(90deg,#5ea1ff,#9b7bff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
header p{opacity:.8}

.filter-panel{
  margin:20px auto;
  max-width:1100px;
  background:#0f1b3d;
  padding:20px;
  border-radius:16px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
label{font-size:13px;color:#00eaff}
select{
  width:100%;
  padding:8px;
  border-radius:6px;
}

.chart-grid{
  max-width:1200px;
  margin:30px auto;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
  gap:24px;
}
.chart-card{
  background:#0e1736;
  padding:15px;
  border-radius:16px;
}
canvas{height:300px!important}
</style>
</head>

<body>

<header>
  <h1>âš¡ Utilities Performance Dashboard</h1>
  <p>Real-time Performance Monitoring & Analytics</p>
</header>

<div class="filter-panel">
  <div>
    <label>PROJECT FILTER</label>
    <select id="projectSelect"></select>
  </div>
  <div>
    <label>YEAR SELECTION</label>
    <select id="yearSelect" multiple size="3"></select>
  </div>
</div>

<div class="chart-grid">
  <div class="chart-card"><canvas id="mwhChart"></canvas></div>
  <div class="chart-card"><canvas id="gtiChart"></canvas></div>
</div>

<script>
const CSV_URL =
"https://raw.githubusercontent.com/Damp2011/utilities-dashboard/main/data.csv";

let rawData=[], charts=[];

fetch(CSV_URL)
.then(r=>r.text())
.then(parseCSV)
.then(initFilters)
.then(renderCharts)
.catch(e=>alert("CSV load failed"));

function parseCSV(text){
  const rows=text.trim().split("\n").map(r=>r.split(","));
  const h=rows.shift();
  rawData=rows.map(r=>{
    let o={};
    h.forEach((k,i)=>o[k.trim()]=r[i]?.trim());
    o.Year=new Date(o.Date||"").getFullYear();
    o.Month=new Date(o.Date||"").getMonth();
    return o;
  });
}

function initFilters(){
  const proj=[...new Set(rawData.map(d=>d["Project name"]))];
  projectSelect.innerHTML='<option>All</option>'+proj.map(p=>`<option>${p}</option>`).join("");

  const yrs=[...new Set(rawData.map(d=>d.Year))].sort();
  yearSelect.innerHTML=yrs.map(y=>`<option selected>${y}</option>`).join("");

  projectSelect.onchange=renderCharts;
  yearSelect.onchange=renderCharts;
}

function getFiltered(){
  const p=projectSelect.value;
  const ys=[...yearSelect.selectedOptions].map(o=>+o.value);
  return rawData.filter(d=>
    (p==="All"||d["Project name"]===p)&&ys.includes(d.Year)
  );
}

function renderCharts(){
  charts.forEach(c=>c.destroy()); charts=[];
  const data=getFiltered();
  if(!data.length) return;

  const months=[...Array(12).keys()].map(m=>new Date(0,m).toLocaleString("en",{month:"short"}));

  const mwh=months.map((_,m)=>data.filter(d=>d.Month===m)
      .reduce((a,b)=>a+(+b["Actual MWh"]||0),0));

  const gti=months.map((_,m)=>data.filter(d=>d.Month===m)
      .reduce((a,b)=>a+(+b["Actual GTI"]||0),0));

  charts.push(new Chart(mwhChart,{
    type:"bar",
    data:{labels:months,datasets:[{label:"Actual MWh",data:mwh}]},
    options:{responsive:true}
  }));

  charts.push(new Chart(gtiChart,{
    type:"line",
    data:{labels:months,datasets:[{label:"Actual GTI",data:gti,tension:.4}]},
    options:{responsive:true}
  }));
}
</script>

</body>
</html>
